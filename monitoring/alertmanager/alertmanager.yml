global:
  resolve_timeout: 5m
  # Telegram Bot –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤ production)
  telegram_api_url: 'https://api.telegram.org'

# –®–∞–±–ª–æ–Ω—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
route:
  receiver: 'default'
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  
  routes:
    # Critical alerts - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 4h
    
    # Warning alerts - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º
    - match:
        severity: warning
      receiver: 'warning-alerts'
      repeat_interval: 12h
    
    # Info alerts - —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
    - match:
        severity: info
      receiver: 'info-alerts'
      repeat_interval: 24h

# –ü–æ–ª—É—á–∞—Ç–µ–ª–∏ (receivers)
receivers:
  - name: 'default'
    telegram_configs:
      - bot_token: '${TELEGRAM_BOT_TOKEN}'
        chat_id: ${TELEGRAM_CHAT_ID}
        parse_mode: 'HTML'
        message: |
          <b>{{ .GroupLabels.alertname }}</b>
          {{ range .Alerts }}
          Status: {{ .Status }}
          {{ .Annotations.summary }}
          {{ .Annotations.description }}
          {{ end }}

  - name: 'critical-alerts'
    telegram_configs:
      - bot_token: '${TELEGRAM_BOT_TOKEN}'
        chat_id: ${TELEGRAM_CHAT_ID}
        parse_mode: 'HTML'
        message: |
          üö® <b>CRITICAL ALERT</b> üö®
          
          <b>Alert:</b> {{ .GroupLabels.alertname }}
          <b>Environment:</b> {{ .GroupLabels.environment }}
          <b>Component:</b> {{ .GroupLabels.component }}
          
          {{ range .Alerts }}
          <b>Status:</b> {{ .Status }}
          <b>Summary:</b> {{ .Annotations.summary }}
          <b>Description:</b> {{ .Annotations.description }}
          <b>Started:</b> {{ .StartsAt }}
          {{ end }}
    # –î—É–±–ª–∏—Ä—É–µ–º –≤ email (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
    email_configs:
      - to: '${ALERT_EMAIL}'
        from: 'alertmanager@samokoder.com'
        smarthost: '${SMTP_HOST}:${SMTP_PORT}'
        auth_username: '${SMTP_USER}'
        auth_password: '${SMTP_PASS}'
        headers:
          Subject: '[CRITICAL] Samokoder Alert: {{ .GroupLabels.alertname }}'
        html: |
          <h2>Critical Alert: {{ .GroupLabels.alertname }}</h2>
          {{ range .Alerts }}
          <p><strong>Status:</strong> {{ .Status }}</p>
          <p><strong>Summary:</strong> {{ .Annotations.summary }}</p>
          <p><strong>Description:</strong> {{ .Annotations.description }}</p>
          <p><strong>Started:</strong> {{ .StartsAt }}</p>
          {{ end }}

  - name: 'warning-alerts'
    telegram_configs:
      - bot_token: '${TELEGRAM_BOT_TOKEN}'
        chat_id: ${TELEGRAM_CHAT_ID}
        parse_mode: 'HTML'
        message: |
          ‚ö†Ô∏è <b>WARNING</b>
          
          <b>Alert:</b> {{ .GroupLabels.alertname }}
          <b>Component:</b> {{ .GroupLabels.component }}
          
          {{ range .Alerts }}
          {{ .Annotations.summary }}
          {{ .Annotations.description }}
          {{ end }}

  - name: 'info-alerts'
    telegram_configs:
      - bot_token: '${TELEGRAM_BOT_TOKEN}'
        chat_id: ${TELEGRAM_CHAT_ID}
        parse_mode: 'HTML'
        message: |
          ‚ÑπÔ∏è <b>INFO</b>
          
          {{ .GroupLabels.alertname }}: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}

# –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ (inhibition rules)
inhibit_rules:
  # –ï—Å–ª–∏ API down, –Ω–µ —Å–ª–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –æ latency/errors
  - source_match:
      alertname: 'APIDown'
    target_match:
      component: 'api'
    equal: ['instance']
  
  # –ï—Å–ª–∏ critical alert, –ø–æ–¥–∞–≤–∏—Ç—å warnings –¥–ª—è —Ç–æ–≥–æ –∂–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['component']
