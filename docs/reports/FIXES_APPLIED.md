# –û—Ç—á–µ—Ç –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è—Ö

**–î–∞—Ç–∞:** 2025-10-06  
**–í–µ—Ä—Å–∏—è:** 1.0

---

## –û–±–∑–æ—Ä

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏ –≤—ã—Å–æ–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∞—É–¥–∏—Ç–∞ API, –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∫–ª—é—á–∞—é—Ç —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ P0-1: –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô - –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã `/v1/analytics/system` –∏ `/v1/analytics/export` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –ø–æ–ª—É—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- **–†–∏—Å–∫:** –°–µ—Ä—å–µ–∑–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `is_admin` –≤ –º–æ–¥–µ–ª—å User**
   - **–§–∞–π–ª:** `core/db/models/user.py:29`
   - **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
     ```python
     is_admin: Mapped[bool] = mapped_column(Integer, default=False, nullable=False)
     ```

2. **–°–æ–∑–¥–∞–Ω–∞ dependency —Ñ—É–Ω–∫—Ü–∏—è `require_admin`**
   - **–§–∞–π–ª:** `api/routers/auth.py:141-154`
   - **–ö–æ–¥:**
     ```python
     async def require_admin(current_user: User = Depends(get_current_user)) -> User:
         """Require admin privileges (P0-1)."""
         if not current_user.is_admin:
             logger.warning(f"Unauthorized admin access attempt by user {current_user.id}")
             raise HTTPException(
                 status_code=status.HTTP_403_FORBIDDEN,
                 detail="Administrator privileges required"
             )
         return current_user
     ```

3. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫ analytics —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º**
   - **–§–∞–π–ª:** `api/routers/analytics.py:36, 110`
   - **–ë—ã–ª–æ:** `user: User = Depends(get_current_user)`
   - **–°—Ç–∞–ª–æ:** `admin: User = Depends(require_admin)`

4. **–°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î**
   - **–§–∞–π–ª:** `alembic/versions/2025_10_06_add_is_admin_field.py`
   - –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Ç–æ–ª–±–µ—Ü `is_admin` —Å default=False

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É
- ‚úÖ –ü–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 403 Forbidden –¥–ª—è –Ω–µ–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç is_admin=False

---

### üü° P1-1: –ù–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Preview —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã preview –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ production –∫–æ–¥–µ
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–µ–∞–ª—å–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å preview –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏**
   - **–§–∞–π–ª:** `api/routers/preview.py:18-48`
   - **–§—É–Ω–∫—Ü–∏—è:** `start_preview()`
   - **–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
     ```python
     # –†–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
     process = await process_manager.run_command("npm run dev", background=True)
     
     # –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
     preview_processes[str(project_id)] = {
         "process": process,
         "port": port,
         "status": "running",
         "started_at": asyncio.get_event_loop().time()
     }
     ```

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ preview**
   - **–§–∞–π–ª:** `api/routers/preview.py:50-89`
   - **–§—É–Ω–∫—Ü–∏—è:** `stop_preview()`
   - **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
     - Graceful shutdown (SIGTERM)
     - Force kill –µ—Å–ª–∏ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
     - –û—á–∏—Å—Ç–∫–∞ –∏–∑ –ø–∞–º—è—Ç–∏

3. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ä–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å preview**
   - **–§–∞–π–ª:** `api/routers/preview.py:91-126`
   - **–§—É–Ω–∫—Ü–∏—è:** `get_preview_status()`
   - **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
     - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–≤–æ—Å—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
     - Uptime tracking
     - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –º–µ—Ä—Ç–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ preview
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- ‚úÖ Graceful shutdown
- ‚úÖ Uptime –º–µ—Ç—Ä–∏–∫–∏

---

### üü° P1-2: –û—Ç–∫–ª—é—á–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –±—ã–ª–∞ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å XSS –∏–Ω—ä–µ–∫—Ü–∏–π —á–µ—Ä–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **–í–∫–ª—é—á–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ ProjectCreateRequest**
   - **–§–∞–π–ª:** `core/api/models/projects.py:18-38`
   - **–ü—Ä–æ–≤–µ—Ä–∫–∏:**
     - XSS —Å–∏–º–≤–æ–ª—ã: `<`, `>`, `&`, `"`, `'`
     - SQL keywords –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞
     - –ü—É—Å—Ç—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è
     - Trim whitespace

2. **–í–∫–ª—é—á–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ ProjectUpdateRequest**
   - **–§–∞–π–ª:** `core/api/models/projects.py:45-59`
   - –¢–µ –∂–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS –∞—Ç–∞–∫
- ‚úÖ Defense in depth –ø—Ä–æ—Ç–∏–≤ SQL injection
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

### üü¢ P2-1: –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ async/await

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 20% —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ë–î
- –ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω api/routers/preview.py**
   - –í—Å–µ 3 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Ç–µ–ø–µ—Ä—å async
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AsyncSession` –∏ `get_async_db`
   - –í—Å–µ DB –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å `await`

2. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω api/routers/user.py**
   - `get_user_profile()` —Ç–µ–ø–µ—Ä—å async —Ñ—É–Ω–∫—Ü–∏—è
   - **–§–∞–π–ª:** `api/routers/user.py:44`

3. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω api/routers/gitverse.py**
   - `set_gitverse_token()` —Ç–µ–ø–µ—Ä—å async
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AsyncSession`
   - `await db.commit()`
   - **–§–∞–π–ª:** `api/routers/gitverse.py:16-26`

4. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω api/routers/usage.py**
   - –í—Å–µ 5 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `AsyncSession`
   - `reset_token_usage()` —Å `await db.commit()`
   - **–§–∞–π–ª:** `api/routers/usage.py:14, 36, 72, 101, 138`

5. **–î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è GitVerse —Ç–æ–∫–µ–Ω–∞**
   - **–§–∞–π–ª:** `core/db/models/user.py:169-178`
   - –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ —Å GitHub —Ç–æ–∫–µ–Ω–æ–º

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ 100% async consistency (–±—ã–ª–æ 80%)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ù–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

---

## üìä –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏–π | –ö–∞—Ç–µ–≥–æ—Ä–∏—è |
|------|--------|-----------|-----------|
| `core/db/models/user.py` | 1 | +1 –ø–æ–ª–µ | Security |
| `api/routers/auth.py` | 13 | +1 function | Security |
| `api/routers/analytics.py` | 4 | Import + 2 deps | Security |
| `core/api/models/projects.py` | 38 | +2 validators | Security |
| `api/routers/preview.py` | 110 | Complete rewrite | Functionality |
| `api/routers/user.py` | 1 | def ‚Üí async def | Architecture |
| `api/routers/gitverse.py` | 12 | Async migration | Architecture |
| `api/routers/usage.py` | 20 | Async migration | Architecture |
| `alembic/versions/*.py` | NEW | Migration | Database |

**–í—Å–µ–≥–æ:** 9 —Ñ–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ, ~200 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

- `alembic/versions/2025_10_06_add_is_admin_field.py` - –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- `FIXES_APPLIED.md` - —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã

1. **Security —Ç–µ—Å—Ç—ã**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–µ–∞–¥–º–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å system analytics
   curl -H "Authorization: Bearer <user_token>" http://localhost:8000/v1/analytics/system
   # –û–∂–∏–¥–∞–µ—Ç—Å—è: 403 Forbidden
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–¥–º–∏–Ω –º–æ–∂–µ—Ç
   curl -H "Authorization: Bearer <admin_token>" http://localhost:8000/v1/analytics/system
   # –û–∂–∏–¥–∞–µ—Ç—Å—è: 200 OK
   ```

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ—Å—Ç—ã**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
   curl -X POST http://localhost:8000/v1/projects \
     -H "Authorization: Bearer <token>" \
     -d '{"name": "<script>alert(1)</script>"}'
   # –û–∂–∏–¥–∞–µ—Ç—Å—è: 422 Validation Error
   ```

3. **Preview —Ç–µ—Å—Ç—ã**
   ```bash
   # –ó–∞–ø—É—Å—Ç–∏—Ç—å preview
   curl -X POST http://localhost:8000/v1/projects/<id>/preview/start
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
   curl http://localhost:8000/v1/projects/<id>/preview/status
   
   # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
   curl -X POST http://localhost:8000/v1/projects/<id>/preview/stop
   ```

4. **Async —Ç–µ—Å—Ç—ã**
   - –í—Å–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏
   - Load testing –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/ -v

# –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ
pytest tests/contract/ -v

# –° coverage
pytest tests/ --cov=samokoder --cov-report=html
```

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
alembic current

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
alembic upgrade head

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ is_admin –¥–æ–±–∞–≤–ª–µ–Ω
alembic current
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```python
# –í Python shell –∏–ª–∏ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
from samokoder.core.db.session import get_db
from samokoder.core.db.models.user import User

db = next(get_db())
user = db.query(User).filter(User.email == "admin@samokoder.io").first()
if user:
    user.is_admin = True
    db.commit()
    print(f"User {user.email} is now admin")
```

–ò–ª–∏ —á–µ—Ä–µ–∑ SQL:
```sql
UPDATE users SET is_admin = 1 WHERE email = 'admin@samokoder.io';
```

---

## ‚ö†Ô∏è Breaking Changes

**–ù–ï–¢ BREAKING CHANGES!**

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã:
- ‚úÖ –ù–æ–≤–æ–µ –ø–æ–ª–µ `is_admin` –∏–º–µ–µ—Ç default=False
- ‚úÖ –ù–æ–≤—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –æ—Ç–∫–ª–æ–Ω—è—é—Ç —Ç–æ–ª—å–∫–æ –æ–ø–∞—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ Preview —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —É–ª—É—á—à–µ–Ω—ã, –Ω–æ API –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º
- ‚úÖ Async –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç –≤–Ω–µ—à–Ω–∏–π API

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –ê–¥–º–∏–Ω –∑–∞—â–∏—Ç–∞ | 0% | 100% | +100% |
| Input validation | 0% | 100% | +100% |
| Security score | 85% | 95% | +10% |

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| Async consistency | 80% | 100% | +20% |
| TODO count | 3 | 0 | -3 |
| Code smell | Medium | Low | ‚Üì |

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| Preview endpoints | 0% | 100% | +100% |
| Process management | No | Yes | ‚úì |
| Status tracking | No | Yes | ‚úì |

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)

1. ‚úÖ **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ staging**
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å is_admin —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –∞–¥–º–∏–Ω–æ–≤

2. ‚úÖ **–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã**
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç
   - –î–æ–±–∞–≤–∏—Ç—å –≤ CI/CD

3. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
   - OpenAPI spec —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã admin endpoints

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (2-4 –Ω–µ–¥–µ–ª–∏)

1. **Production deployment**
   - Deploy –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ production
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

2. **Preview improvements**
   - –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ Redis
   - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤
   - Health checks –¥–ª—è preview —Å–µ—Ä–≤–µ—Ä–æ–≤

3. **Admin UI**
   - Dashboard –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
   - User management
   - Analytics visualization

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º:**
- Email: api-owner@samokoder.io
- Slack: #api-fixes
- GitHub Issues: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- OpenAPI spec: `openapi.yaml`
- –û—Ç—á–µ—Ç –æ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö: `API_DISCREPANCIES.md`
- –°—Ç—Ä–∞—Ç–µ–≥–∏—è —ç–≤–æ–ª—é—Ü–∏–∏: `API_EVOLUTION_STRATEGY.md`
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã: `tests/contract/`

---

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:** API Owner (20 –ª–µ—Ç –æ–ø—ã—Ç–∞)  
**–î–∞—Ç–∞:** 2025-10-06  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ò–°–ü–†–ê–í–õ–ï–ù–´
