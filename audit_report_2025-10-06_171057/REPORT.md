# Samokoder — Комплексный аудит кода и архитектуры

Дата: 2025-10-06 17:10:57

## Executive Summary
- Безопасность: основной риск — доступ к docker.sock (даже ro) и запуск превью‑процессов вне контейнеров. CSP в prod нуждается в ужесточении; httpx запросы — без явных таймаутов.
- Производительность: `ProjectState` как крупный JSONB и потенциальные N+1 при загрузке файлов. Миграции индексов есть, нормализация частично начата.
- Надёжность: очистка контейнеров по label/времени, таймауты/ретраи для внешних HTTP и телеметрии.
- DevEx/DevOps: локальная среда лишена многих аудиторских CLI; в CI — хорошо покрыто. Рекомендуется dev‑container/Makefile цели.
- Наблюдаемость: метрики Prometheus детальные, есть SLO; добавить счётчики таймаутов/ошибок процессов и orphaned‑containers.

## Контекст и гипотезы
См. `context_summary.md` (Фаза 1).

## Ключевые метрики и визуализации
- Статистика кода: частично собрана (ripgrep):
  - Python ~29.8k строк; JS ~2.3k; CSS ~0.9k
- Инструменты аудита недоступны в окружении (см. `artifacts/metrics_summary.json`, `logs/tooling_versions.log`).
- Архитектура и доменная модель: см. `artifacts/architecture.md`, `artifacts/domain_model.md`.

## Детальные находки
См. `artifacts/findings.md`.

## Рекомендации (высокий уровень)
- Убрать прямой доступ к docker.sock; изолировать исполнение (Sysbox/rootless/K8s job). Для превью — контейнеры с `network=none`, cgroups, allow‑list скриптов.
- Ввести таймауты и унифицированные retries для всех httpx вызовов; CSP ужесточить для prod (без inline/eval).
- Завершить нормализацию `ProjectState`, внедрить eager loading файлов; использовать кэш LLM‑ответов.
- Расширить метрики: таймауты/ошибки процессов, GC orphaned‑containers, счётчики превью‑процессов.
- Улучшить DevEx: dev‑container, Makefile, локальные аудит‑команды.
