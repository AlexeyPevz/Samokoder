# Регрессионное тестирование критических пользовательских потоков

## Анализ изменённых файлов

На основе анализа последних коммитов выявлены следующие критически изменённые компоненты:

### P0 (Критические - блокируют мёрж)
1. **Аутентификация и авторизация** (`backend/api/auth.py`, `backend/auth/dependencies.py`)
2. **Управление проектами** (`backend/api/projects.py`)
3. **Безопасность** (`backend/middleware/`, `backend/security/`)
4. **Основные сервисы** (`backend/services/`)

### P1 (Важные - требуют внимания)
1. **AI сервис** (`backend/api/ai.py`, `backend/services/ai_service.py`)
2. **Мониторинг** (`backend/monitoring.py`)
3. **Конфигурация** (`backend/core/config.py`)

## Критические пользовательские потоки

### 1. Аутентификация и регистрация (P0)

**Поток:** Пользователь регистрируется → входит в систему → получает доступ к API

**Критические изменения:**
- Строгая валидация паролей
- Rate limiting для аутентификации
- Хеширование паролей с солью
- JWT токены с проверкой срока действия

**Тестовые сценарии:**
1. Успешная регистрация с валидными данными
2. Отклонение слабых паролей
3. Rate limiting при множественных попытках входа
4. Валидация JWT токенов
5. Безопасный выход из системы

### 2. Управление проектами (P0)

**Поток:** Пользователь создаёт проект → редактирует → удаляет

**Критические изменения:**
- Создание workspace директорий
- Управление состоянием проектов
- Проверка прав доступа
- Soft delete проектов

**Тестовые сценарии:**
1. Создание проекта с валидными данными
2. Получение списка проектов пользователя
3. Обновление проекта
4. Удаление проекта (soft delete)
5. Проверка изоляции проектов между пользователями

### 3. AI сервис и генерация (P1)

**Поток:** Пользователь отправляет запрос → получает AI ответ → отслеживает использование

**Критические изменения:**
- Централизованный AI сервис
- Управление API ключами
- Логирование использования
- Rate limiting для AI запросов

**Тестовые сценарии:**
1. Чат с AI через централизованный сервис
2. Валидация API ключей
3. Отслеживание использования токенов
4. Обработка ошибок AI провайдеров

### 4. Безопасность и middleware (P0)

**Поток:** Запрос проходит через middleware → обрабатывается → возвращается ответ

**Критические изменения:**
- CORS настройки
- CSRF защита
- Rate limiting
- Валидация входных данных
- Безопасные заголовки

**Тестовые сценарии:**
1. CORS preflight запросы
2. CSRF токены для изменяющих запросов
3. Rate limiting для различных эндпоинтов
4. Валидация входных данных
5. Безопасные HTTP заголовки

## План тестирования

### Этап 1: Подготовка (1 час)
- Настройка тестового окружения
- Подготовка тестовых данных
- Настройка моков для внешних сервисов

### Этап 2: P0 тесты (2 часа)
- Аутентификация и авторизация
- Управление проектами
- Безопасность и middleware

### Этап 3: P1 тесты (1 час)
- AI сервис
- Мониторинг
- Производительность

### Этап 4: Интеграционные тесты (1 час)
- Полные пользовательские потоки
- Взаимодействие между компонентами

## Критерии успеха

### P0 тесты
- ✅ Все тесты аутентификации проходят
- ✅ Все тесты управления проектами проходят
- ✅ Все тесты безопасности проходят
- ✅ Нет уязвимостей безопасности

### P1 тесты
- ✅ AI сервис работает стабильно
- ✅ Производительность в пределах нормы
- ✅ Мониторинг функционирует

## Автоматизация

Все тесты должны быть автоматизированы и выполняться:
- При каждом коммите (pre-commit hooks)
- При создании PR (CI/CD pipeline)
- Ежедневно (scheduled runs)

## Отчётность

После выполнения тестов будет создан отчёт с:
- Результатами всех тестов
- Найденными проблемами
- Рекомендациями по исправлению
- Статусом готовности к релизу